-- 커뮤니티 테이블 샘플 데이터 삽입

-- 1. 샘플 사용자 프로필 생성 (기존 users 테이블과 연동)
-- 주의: 실제 users 테이블에 사용자가 있어야 함

-- 샘플 사용자 프로필 데이터
INSERT INTO public.user_profiles (
    user_id,
    display_name,
    avatar_url,
    bio,
    is_korean,
    country,
    language_preference,
    total_points,
    level,
    experience_points,
    badges
) VALUES 
-- 한국 사용자들
('00000000-0000-0000-0000-000000000001', '김민지', 'https://api.dicebear.com/7.x/avataaars/svg?seed=kim', '한국 문화를 사랑하는 대학생입니다!', true, 'KR', 'ko', 150, 3, 200, ARRAY['early_bird', 'helpful']),
('00000000-0000-0000-0000-000000000002', '박지영', 'https://api.dicebear.com/7.x/avataaars/svg?seed=park', '화장품 전문가입니다 💄', true, 'KR', 'ko', 320, 4, 500, ARRAY['expert', 'beauty_guru']),
('00000000-0000-0000-0000-000000000003', '이수진', 'https://api.dicebear.com/7.x/avataaars/svg?seed=lee', '여행을 좋아해요 ✈️', true, 'KR', 'ko', 80, 2, 100, ARRAY['traveler']),

-- 글로벌 사용자들
('00000000-0000-0000-0000-000000000004', 'Maria', 'https://api.dicebear.com/7.x/avataaars/svg?seed=maria', '¡Hola! Soy de México 🇲🇽', false, 'MX', 'es', 200, 3, 250, ARRAY['friendly', 'language_expert']),
('00000000-0000-0000-0000-000000000005', 'Carlos', 'https://api.dicebear.com/7.x/avataaars/svg?seed=carlos', 'Brasileiro apaixonado por K-pop! 🇧🇷', false, 'BR', 'es', 180, 3, 220, ARRAY['kpop_fan', 'music_lover']),
('00000000-0000-0000-0000-000000000006', 'Sofia', 'https://api.dicebear.com/7.x/avataaars/svg?seed=sofia', 'Fashion enthusiast from Argentina 👗', false, 'AR', 'es', 120, 2, 150, ARRAY['fashionista']),
('00000000-0000-0000-0000-000000000007', 'Ana', 'https://api.dicebear.com/7.x/avataaars/svg?seed=ana', 'Colombiana estudiando coreano 🇨🇴', false, 'CO', 'es', 90, 2, 120, ARRAY['student', 'language_learner']),
('00000000-0000-0000-0000-000000000008', 'Diego', 'https://api.dicebear.com/7.x/avataaars/svg?seed=diego', 'Peruano amante de la comida coreana 🍜', false, 'PE', 'es', 110, 2, 140, ARRAY['food_lover']);

-- 2. 샘플 게시물 데이터
INSERT INTO public.posts (
    user_id,
    type,
    title,
    content,
    category,
    tags,
    language,
    is_solved,
    is_best,
    is_notice,
    view_count,
    like_count,
    comment_count
) VALUES 
-- 질문 게시물들
('00000000-0000-0000-0000-000000000004', 'question', '한국 화장품 브랜드 추천해주세요!', '한국에 처음 와서 화장품을 사려고 하는데, 어떤 브랜드가 좋을까요? 피부가 민감해서 천연 성분이 들어간 제품을 찾고 있어요. 가격대는 중간 정도로 생각하고 있습니다.', 'beauty', ARRAY['화장품', '민감성피부', '추천', '천연성분'], 'ko', false, false, false, 89, 12, 5),
('00000000-0000-0000-0000-000000000005', 'question', '서울에서 데이트하기 좋은 곳', '여자친구와 서울에서 데이트할 계획인데, 로맨틱하고 특별한 장소가 있을까요? 예산은 적당히 생각하고 있고, 교통편도 편리한 곳이면 좋겠어요.', 'travel', ARRAY['데이트', '서울', '로맨틱', '여행'], 'ko', true, false, false, 67, 8, 3),
('00000000-0000-0000-0000-000000000006', 'question', '한국 전통 음식 맛집 추천', '한국의 전통 음식을 제대로 맛볼 수 있는 맛집을 찾고 있어요. 특히 비빔밥과 김치찌개, 불고기 같은 대표적인 음식들을 맛보고 싶어요.', 'food', ARRAY['전통음식', '맛집', '비빔밥', '김치찌개'], 'ko', false, false, false, 124, 15, 7),
('00000000-0000-0000-0000-000000000007', 'question', '한국 패션 트렌드 2024', '올해 한국에서 유행하는 패션 아이템이나 스타일이 궁금해요. 어떤 것이 핫할까요? 젊은 층 사이에서 인기 있는 브랜드도 알고 싶어요.', 'fashion', ARRAY['패션', '트렌드', '2024', '한국스타일'], 'ko', false, false, false, 45, 6, 2),

-- 스토리 게시물들
('00000000-0000-0000-0000-000000000001', 'story', '한국에서의 첫 달 경험담', '한국에 온 지 한 달이 지났는데, 정말 많은 것을 배우고 있어요. 처음에는 언어가 어려웠지만, 한국 친구들이 정말 친절하게 도와줘서 지금은 많이 익숙해졌어요. 특히 한국 음식이 정말 맛있어서 매일 새로운 것을 시도해보고 있어요!', 'daily', ARRAY['한국생활', '경험담', '언어학습', '음식'], 'ko', false, true, false, 156, 23, 12),
('00000000-0000-0000-0000-000000000002', 'story', 'K-pop 콘서트 갔다온 후기', '드디어 꿈에 그리던 BTS 콘서트에 갔다왔어요! 정말 감동적이었고, 한국 팬들과 함께 응원하는 경험이 너무 좋았어요. 콘서트장 분위기도 정말 대단했고, 다음에도 꼭 다시 가고 싶어요.', 'culture', ARRAY['K-pop', 'BTS', '콘서트', '팬'], 'ko', false, true, false, 234, 45, 18),

-- 자유게시판 게시물들
('00000000-0000-0000-0000-000000000003', 'freeboard', '한국어 공부 방법 공유해요', '한국어를 공부하는 방법에 대해 공유하고 싶어요. 저는 드라마를 보면서 공부하는 방법이 가장 효과적이었어요. 특히 자막을 한국어로 바꿔서 보면 정말 도움이 많이 됩니다!', 'daily', ARRAY['한국어', '공부방법', '드라마', '언어학습'], 'ko', false, false, false, 78, 9, 4),
('00000000-0000-0000-0000-000000000008', 'freeboard', '한국 친구들과의 만남', '한국 친구들과 처음 만났을 때의 이야기를 공유해요. 정말 친절하고 따뜻한 사람들이었어요. 언어가 서툴렀지만 서로 이해하려고 노력하는 모습이 정말 좋았어요.', 'daily', ARRAY['한국친구', '만남', '친절함', '문화교류'], 'ko', false, false, false, 92, 11, 6),

-- 공지사항
('00000000-0000-0000-0000-000000000001', 'news', '커뮤니티 이용 규칙 안내', '안녕하세요! Amiko 커뮤니티를 이용해주셔서 감사합니다. 더 나은 커뮤니티를 위해 몇 가지 규칙을 안내드립니다. 1. 서로를 존중하는 마음으로 소통해주세요. 2. 스팸이나 광고성 게시물은 금지입니다. 3. 개인정보 보호에 주의해주세요.', 'notice', ARRAY['공지사항', '이용규칙', '안내'], 'ko', false, false, true, 345, 28, 0);

-- 3. 샘플 댓글 데이터
INSERT INTO public.comments (
    post_id,
    user_id,
    content,
    language,
    is_accepted,
    like_count
) VALUES 
-- 질문 1에 대한 답변들
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000002', '민감성 피부라면 에뛰드하우스나 이니스프리가 좋아요! 특히 알로에 성분이 들어간 제품들이 피부에 자극이 적어서 추천해요. 가격도 합리적이고요.', 'ko', false, 8),
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '닥터벨벳도 추천해요. 약국에서 파는 브랜드라서 성분이 안전하고 피부에 자극이 적어요. 저도 민감성 피부인데 이 브랜드 제품들 잘 사용하고 있어요.', 'ko', true, 5),

-- 질문 2에 대한 답변들
('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000003', '한강공원이 정말 좋아요! 특히 저녁에 가면 야경이 정말 아름답고 로맨틱해요. 돗자리 깔고 간단한 간식 가져가서 피크닉하기도 좋고요.', 'ko', true, 6),
('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', '남산타워도 추천해요! 전망이 정말 좋고, 케이블카 타고 올라가면 정말 로맨틱해요. 사진 찍기도 좋고요.', 'ko', false, 4),

-- 질문 3에 대한 답변들
('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000002', '명동에 있는 전통 음식점들이 정말 좋아요! 특히 비빔밥은 정말 맛있고, 김치찌개도 정통 맛을 느낄 수 있어요. 가격도 합리적이고요.', 'ko', true, 7),
('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003', '인사동도 추천해요! 전통 찻집에서 차 마시면서 전통 과자도 맛볼 수 있어요. 정말 한국적인 분위기를 느낄 수 있어요.', 'ko', false, 3),

-- 스토리 게시물에 대한 댓글들
('00000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000004', '정말 좋은 경험이었겠어요! 저도 한국에 가고 싶어요. 어떤 음식을 가장 좋아하세요?', 'ko', false, 2),
('00000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000005', '한국 친구들이 정말 친절하죠! 저도 처음에 도움을 많이 받았어요. 계속 좋은 경험 하세요!', 'ko', false, 1),

-- 자유게시판 게시물에 대한 댓글들
('00000000-0000-0000-0000-000000000007', '00000000-0000-0000-0000-000000000006', '저도 드라마로 한국어 공부해요! 정말 효과적인 방법이에요. 어떤 드라마 추천하세요?', 'ko', false, 3),
('00000000-0000-0000-0000-000000000007', '00000000-0000-0000-0000-000000000007', '좋은 팁 감사해요! 저도 시도해볼게요. 혹시 다른 공부 방법도 있나요?', 'ko', false, 1);

-- 4. 샘플 반응 데이터
INSERT INTO public.reactions (
    user_id,
    post_id,
    type
) VALUES 
-- 게시물 좋아요들
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000007', '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000008', '00000000-0000-0000-0000-000000000001', 'like'),

-- 댓글 좋아요들
('00000000-0000-0000-0000-000000000001', NULL, '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000002', NULL, '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000003', NULL, '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000004', NULL, '00000000-0000-0000-0000-000000000001', 'like'),
('00000000-0000-0000-0000-000000000005', NULL, '00000000-0000-0000-0000-000000000001', 'like');

-- 5. 샘플 포인트 기록 데이터
INSERT INTO public.points (
    user_id,
    type,
    amount,
    description,
    related_id,
    related_type
) VALUES 
-- 게시물 작성 포인트
('00000000-0000-0000-0000-000000000001', 'story_post', 5, '스토리 게시물 작성', '00000000-0000-0000-0000-000000000005', 'post'),
('00000000-0000-0000-0000-000000000002', 'story_post', 5, '스토리 게시물 작성', '00000000-0000-0000-0000-000000000006', 'post'),
('00000000-0000-0000-0000-000000000003', 'freeboard_post', 2, '자유게시판 게시물 작성', '00000000-0000-0000-0000-000000000007', 'post'),
('00000000-0000-0000-0000-000000000004', 'question_post', 5, '질문 게시물 작성', '00000000-0000-0000-0000-000000000001', 'post'),
('00000000-0000-0000-0000-000000000005', 'question_post', 5, '질문 게시물 작성', '00000000-0000-0000-0000-000000000002', 'post'),
('00000000-0000-0000-0000-000000000006', 'question_post', 5, '질문 게시물 작성', '00000000-0000-0000-0000-000000000003', 'post'),
('00000000-0000-0000-0000-000000000007', 'question_post', 5, '질문 게시물 작성', '00000000-0000-0000-0000-000000000004', 'post'),
('00000000-0000-0000-0000-000000000008', 'freeboard_post', 2, '자유게시판 게시물 작성', '00000000-0000-0000-0000-000000000008', 'post'),

-- 댓글 작성 포인트
('00000000-0000-0000-0000-000000000002', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000001', 'comment'),
('00000000-0000-0000-0000-000000000001', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000002', 'comment'),
('00000000-0000-0000-0000-000000000003', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000003', 'comment'),
('00000000-0000-0000-0000-000000000001', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000004', 'comment'),
('00000000-0000-0000-0000-000000000002', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000005', 'comment'),
('00000000-0000-0000-0000-000000000003', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000006', 'comment'),
('00000000-0000-0000-0000-000000000004', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000007', 'comment'),
('00000000-0000-0000-0000-000000000005', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000008', 'comment'),
('00000000-0000-0000-0000-000000000006', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000009', 'comment'),
('00000000-0000-0000-0000-000000000007', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000010', 'comment'),
('00000000-0000-0000-0000-000000000008', 'comment', 5, '댓글 작성', '00000000-0000-0000-0000-000000000011', 'comment'),

-- 반응 받은 포인트
('00000000-0000-0000-0000-000000000001', 'reaction_received', 2, '댓글에 좋아요 받음', '00000000-0000-0000-0000-000000000001', 'comment'),
('00000000-0000-0000-0000-000000000002', 'reaction_received', 2, '댓글에 좋아요 받음', '00000000-0000-0000-0000-000000000002', 'comment'),
('00000000-0000-0000-0000-000000000003', 'reaction_received', 2, '댓글에 좋아요 받음', '00000000-0000-0000-0000-000000000003', 'comment'),
('00000000-0000-0000-0000-000000000001', 'reaction_received', 2, '댓글에 좋아요 받음', '00000000-0000-0000-0000-000000000004', 'comment'),
('00000000-0000-0000-0000-000000000002', 'reaction_received', 2, '댓글에 좋아요 받음', '00000000-0000-0000-0000-000000000005', 'comment'),

-- 일일 로그인 포인트
('00000000-0000-0000-0000-000000000001', 'daily_login', 1, '일일 로그인 보상', NULL, NULL),
('00000000-0000-0000-0000-000000000002', 'daily_login', 1, '일일 로그인 보상', NULL, NULL),
('00000000-0000-0000-0000-000000000003', 'daily_login', 1, '일일 로그인 보상', NULL, NULL),
('00000000-0000-0000-0000-000000000004', 'daily_login', 1, '일일 로그인 보상', NULL, NULL),
('00000000-0000-0000-0000-000000000005', 'daily_login', 1, '일일 로그인 보상', NULL, NULL);

-- 6. 게시물 통계 업데이트 (트리거로 자동 계산되지만 수동으로도 업데이트)
UPDATE public.posts SET 
    comment_count = (
        SELECT COUNT(*) FROM public.comments 
        WHERE post_id = posts.id AND parent_id IS NULL
    ),
    like_count = (
        SELECT COUNT(*) FROM public.reactions 
        WHERE post_id = posts.id AND type = 'like'
    );

-- 7. 댓글 통계 업데이트
UPDATE public.comments SET 
    like_count = (
        SELECT COUNT(*) FROM public.reactions 
        WHERE comment_id = comments.id AND type = 'like'
    );

-- 8. 사용자 프로필 포인트 업데이트
UPDATE public.user_profiles SET 
    total_points = (
        SELECT COALESCE(SUM(amount), 0) FROM public.points 
        WHERE user_id = user_profiles.user_id
    ),
    experience_points = (
        SELECT COALESCE(SUM(ABS(amount)), 0) FROM public.points 
        WHERE user_id = user_profiles.user_id
    ),
    level = CASE 
        WHEN (
            SELECT COALESCE(SUM(ABS(amount)), 0) FROM public.points 
            WHERE user_id = user_profiles.user_id
        ) >= 1000 THEN 5
        WHEN (
            SELECT COALESCE(SUM(ABS(amount)), 0) FROM public.points 
            WHERE user_id = user_profiles.user_id
        ) >= 500 THEN 4
        WHEN (
            SELECT COALESCE(SUM(ABS(amount)), 0) FROM public.points 
            WHERE user_id = user_profiles.user_id
        ) >= 200 THEN 3
        WHEN (
            SELECT COALESCE(SUM(ABS(amount)), 0) FROM public.points 
            WHERE user_id = user_profiles.user_id
        ) >= 50 THEN 2
        ELSE 1
    END;
