# 자유게시판 이미지 업로드 기능 가이드

## 기능 개요
자유게시판에서 게시글 작성 시 이미지를 첨부할 수 있는 기능이 추가되었습니다.

## 주요 기능

### 1. 이미지 업로드
- **지원 형식**: JPG, PNG, GIF, WebP
- **파일 크기 제한**: 5MB 이하
- **업로드 개수**: 최대 5개
- **업로드 방식**: Supabase Storage 사용

### 2. 이미지 미리보기
- 업로드 전 로컬 미리보기 제공
- 업로드된 이미지 삭제 기능
- 그리드 형태의 이미지 갤러리 표시

### 3. 게시글 표시
- 게시글 목록에서 이미지 첨부 여부 표시 (📷 아이콘)
- 게시글 상세에서 이미지 갤러리 형태로 표시
- 이미지 클릭 시 새 탭에서 원본 크기로 열기

## 설정 방법

### 1. 데이터베이스 설정
다음 SQL 스크립트를 실행하여 Storage 버킷을 설정하세요:

```sql
-- database/setup-storage.sql 실행
```

### 2. 환경 변수 확인
`.env.local` 파일에 다음 환경 변수가 설정되어 있는지 확인하세요:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

## 사용 방법

### 1. 게시글 작성
1. 자유게시판에서 "글쓰기" 버튼 클릭
2. 제목과 내용 입력
3. "이미지 첨부" 섹션에서 이미지 파일 선택
4. 업로드된 이미지 미리보기 확인
5. 필요시 이미지 삭제 (× 버튼)
6. "작성하기" 버튼으로 게시글 등록

### 2. 이미지 관리
- **업로드**: 드래그 앤 드롭 또는 클릭으로 파일 선택
- **삭제**: 각 이미지 우상단의 × 버튼으로 삭제
- **미리보기**: 업로드 전 로컬 미리보기 제공

## API 엔드포인트

### 이미지 업로드
```
POST /api/upload/image
Content-Type: multipart/form-data
Authorization: Bearer {token}

Body:
- file: 이미지 파일
- folder: 업로드 폴더 (기본값: 'posts')
```

### 이미지 삭제
```
DELETE /api/upload/image?path={file_path}
Authorization: Bearer {token}
```

## 보안 설정

### Storage 정책
- 모든 사용자가 이미지 읽기 가능
- 인증된 사용자만 이미지 업로드 가능
- 사용자는 자신이 업로드한 이미지만 삭제 가능

### 파일 검증
- 파일 타입 검증 (이미지 파일만 허용)
- 파일 크기 제한 (5MB)
- 파일명 중복 방지 (타임스탬프 + 랜덤 문자열)

## 문제 해결

### 일반적인 문제
1. **업로드 실패**: 파일 크기나 형식 확인
2. **이미지 표시 안됨**: Supabase Storage 설정 확인
3. **권한 오류**: 사용자 인증 상태 확인

### 로그 확인
브라우저 개발자 도구의 콘솔에서 다음 로그를 확인하세요:
- `[UPLOAD_IMAGE]` - 이미지 업로드 관련 로그
- `[POST_CREATE]` - 게시글 작성 관련 로그

## 추가 개발 사항

### 향후 개선 계획
1. 이미지 압축 기능
2. 이미지 편집 기능 (크롭, 리사이즈)
3. 이미지 최적화 (WebP 변환)
4. 이미지 CDN 연동

### 성능 최적화
- 이미지 lazy loading
- 썸네일 생성
- 캐싱 전략 개선
